/* Polices : iA Writer Duo pour le contenu, Inter pour l'interface */
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {

  /* iA Writer Duo est chargée via next/font/local uniquement dans la Salle du Temps */
  :root {
    /* === SOLARIZED PALETTE === */
    /* Base tones (monotones) */
    --sol-base03: #002b36;
    /* darkest - dark bg */
    --sol-base02: #073642;
    /* dark bg highlight */
    --sol-base01: #586e75;
    /* dark secondary text */
    --sol-base00: #657b83;
    /* light primary text */
    --sol-base0: #839496;
    /* dark primary text */
    --sol-base1: #93a1a1;
    /* light secondary text */
    --sol-base2: #eee8d5;
    /* light bg highlight */
    --sol-base3: #fdf6e3;
    /* lightest - light bg */

    /* Accent colors */
    --sol-yellow: #b58900;
    --sol-orange: #cb4b16;
    --sol-red: #dc322f;
    --sol-magenta: #d33682;
    --sol-violet: #6c71c4;
    --sol-blue: #268bd2;
    --sol-cyan: #2aa198;
    --sol-green: #859900;

    /* === SEMANTIC TOKENS (Light Mode) === */
    --background: #fdf6e3;
    /* sol-base3 */
    --background-elevated: #eee8d5;
    /* sol-base2 */
    --foreground: #657b83;
    /* sol-base00 */
    --subtle: #93a1a1;
    /* sol-base1 */
    --accent: #2aa198;
    /* sol-cyan */
    --accent-hover: #268bd2;
    /* sol-blue */
    --destructive: #dc322f;
    /* sol-red */
    --success: #859900;
    /* sol-green */
    --warning: #b58900;
    /* sol-yellow */
    --muted: #eee8d5;
    /* sol-base2 */
  }

  /* Dark Mode */
  .dark,
  [data-theme="dark"] {
    --background: #002b36;
    /* sol-base03 */
    --background-elevated: #073642;
    /* sol-base02 */
    --foreground: #839496;
    /* sol-base0 */
    --subtle: #586e75;
    /* sol-base01 */
    --accent: #2aa198;
    /* sol-cyan */
    --accent-hover: #268bd2;
    /* sol-blue */
    --muted: #073642;
    /* sol-base02 */
  }

  /* Smooth scroll global */
  html {
    scroll-behavior: smooth;
  }

  @media (prefers-reduced-motion: reduce) {
    html {
      scroll-behavior: auto;
    }
  }

  /* Transitions globales plus douces - style Apple */
  * {
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Amélioration focus pour accessibilité */
  *:focus-visible {
    outline: 2px solid hsl(var(--accent));
    outline-offset: 2px;
  }

  button:focus-visible {
    outline-offset: 4px;
  }

  /* Optionnel: pour un futur thème sombre */
  /* .dark { ... } */

  body {
    @apply bg-background text-foreground font-sans;
    /* Ajout d'un dégradé radial très subtil pour donner vie au fond */
    background-image:
      radial-gradient(circle at top left, hsl(220 10% 95%), transparent),
      radial-gradient(circle at bottom right, hsl(220 90% 98%), transparent);
    background-size: 100vw 100vh;
    background-attachment: fixed;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    /* Revenir à la fonte par défaut du site (IBM Plex via font-serif) */
    @apply font-serif font-semibold;
  }

  a {
    @apply hover:underline;
    text-underline-offset: 0.2em;
    transition: opacity 0.2s ease;
  }

  a:hover {
    opacity: 0.8;
  }

  a:active {
    opacity: 0.6;
  }

  /* Mode Salle du Temps - verrouillage scroll body + plein écran total */
  .salle-du-temps-active {
    overflow: hidden;
    /* iA Writer-like plain cream background, no gradients */
    background-color: #fafaf8 !important;
    background-image: none !important;
    /* Force le plein écran même si requestFullscreen échoue */
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    z-index: 9999 !important;
  }

  /* Cacher totalement la navbar et tous les éléments d'interface en mode Salle du Temps */
  .salle-du-temps-active header,
  .salle-du-temps-active nav,
  .salle-du-temps-active aside,
  .salle-du-temps-active footer {
    display: none !important;
  }

  /* Masquer la barre de défilement des navigateurs en mode Salle du Temps */
  .salle-du-temps-active::-webkit-scrollbar {
    display: none !important;
  }

  .salle-du-temps-active {
    scrollbar-width: none !important;
    -ms-overflow-style: none !important;
  }

  /* Animations pour la Salle du Temps */
  @keyframes salleEnter {
    from {
      opacity: 0;
      transform: scale(0.98);
    }

    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  @keyframes salleExit {
    from {
      opacity: 1;
      transform: scale(1);
    }

    to {
      opacity: 0;
      transform: scale(0.98);
    }
  }

  /* Force le fond crème uniforme dans CodeMirror en mode immersif */
  .salle-du-temps-container .cm-editor,
  .salle-du-temps-container .cm-scroller,
  .salle-du-temps-container .cm-content,
  .salle-du-temps-container .cm-gutters,
  .salle-du-temps-container .cm-activeLine,
  .salle-du-temps-container .cm-activeLineGutter {
    background-color: #fafaf8 !important;
  }

  /* Suppression de toute bordure ou ligne dans la Salle du Temps */
  .salle-du-temps-container .cm-editor {
    outline: none !important;
    border: none !important;
  }

  /* Cursor clignotement régulier (pas de saut) */
  .salle-du-temps-container .cm-cursor {
    border-left-color: #333 !important;
    border-left-width: 2px !important;
    animation: cursorBlink 1s steps(2, start) infinite;
  }

  @keyframes cursorBlink {
    0% {
      opacity: 1;
    }

    50% {
      opacity: 0;
    }

    100% {
      opacity: 1;
    }
  }

  /* Transition douce sur le texte lors du scroll */
  .salle-du-temps-container .cm-line {
    transition: opacity 0.15s ease;
  }

  /* Salle du Temps - immersion totale */
  .salle-editor .cm-editor {
    height: 100% !important;
    background-color: #fafaf8 !important;
  }

  .salle-editor .cm-scroller {
    align-items: center !important;
    padding-top: 0 !important;
    padding-bottom: 0 !important;
  }

  .salle-editor .cm-content {
    padding-top: 50vh !important;
    padding-bottom: 50vh !important;
  }

  /* Masquer tous les éléments d'interface en mode immersif */
  .salle-du-temps-container .cm-selectionBackground,
  .salle-du-temps-container .cm-activeLine,
  .salle-du-temps-container .cm-activeLineGutter {
    background-color: transparent !important;
  }

  /* Sélection de texte subtile */
  .salle-du-temps-container ::selection {
    background-color: rgba(0, 0, 0, 0.08);
  }

  .salle-du-temps-container ::-moz-selection {
    background-color: rgba(0, 0, 0, 0.08);
  }
}

@layer components {

  /* Animations légères et réutilisables */
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(4px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes slideDown {
    from {
      transform: translateY(-8px);
      opacity: 0;
    }

    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  @keyframes subtlePulse {

    0%,
    100% {
      opacity: 1;
    }

    50% {
      opacity: 0.8;
    }
  }

  .animate-fadeIn {
    animation: fadeIn 0.5s ease-out;
  }

  .fade-in {
    animation: fadeIn 200ms ease-out both;
  }

  .slide-down {
    animation: slideDown 220ms ease-out both;
  }

  /* Masquer scrollbar horizontale du carrousel (mobile) */
  .no-scrollbar {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  .no-scrollbar::-webkit-scrollbar {
    display: none;
  }

  /* UI Verre - Utilitaire glass */
  .glass {
    @apply backdrop-blur-md border border-white/10;
    background-color: rgba(253, 246, 227, 0.35);
    box-shadow:
      0 4px 6px -1px rgba(0, 0, 0, 0.05),
      0 2px 4px -1px rgba(0, 0, 0, 0.03);
  }

  .dark .glass {
    background-color: rgba(0, 43, 54, 0.35);
  }

  .glass-light {
    @apply backdrop-blur-sm border border-white/10;
    background-color: rgba(253, 246, 227, 0.25);
  }

  .dark .glass-light {
    background-color: rgba(0, 43, 54, 0.25);
  }

  /* Constellation intégrée v2 - Budget opacité global */
  .interactive-graph-background {
    opacity: 0.8;
    transition: opacity 0.6s ease;
  }

  .interactive-graph-background .node-main {
    opacity: 0.6;
    transition: opacity 0.3s ease;
  }

  .interactive-graph-background .node-label {
    opacity: 0.35;
  }

  .interactive-graph-background .edge {
    opacity: 0.25;
  }

  /* Overlay clones */
  .interactive-graph-overlay {
    z-index: 1;
  }

  /* Supprimer les soulignements sur les liens SVG */
  .interactive-graph-overlay a,
  .interactive-graph-background a {
    text-decoration: none !important;
  }

  .interactive-graph-overlay a:hover,
  .interactive-graph-background a:hover {
    text-decoration: none !important;
  }

  /* Constellation intégrée - Animations et états */
  @keyframes dash {
    from {
      stroke-dashoffset: 10;
    }

    to {
      stroke-dashoffset: 0;
    }
  }

  @keyframes twinkle {

    0%,
    100% {
      opacity: 0.02;
    }

    50% {
      opacity: 0.08;
    }
  }

  /* Zone de frappe invisible sur fond */
  .interactive-graph-background .node-hit {
    opacity: 0;
    cursor: pointer;
    pointer-events: auto;
  }

  .interactive-graph-background .node-hit:focus {
    opacity: 0.05;
    outline: 2px solid hsl(var(--accent));
    outline-offset: 2px;
  }

  /* États voisinage sur fond */
  .interactive-graph-background [data-id].neighbor .node-main {
    opacity: 0.45;
    transform: scale(1.05);
  }

  /* Arêtes actives sur fond */
  .interactive-graph-background .edge.neighbor-active {
    opacity: 0.25;
    stroke-width: 2;
    stroke-dasharray: 5 5;
    animation: dash 1.8s ease-in-out infinite;
  }

  /* Twinkles subtils pour signaler la présence */
  @media (prefers-reduced-motion: no-preference) {
    .interactive-graph .node-main:nth-child(3n) {
      animation: twinkle 8s ease-in-out infinite;
      animation-delay: 0s;
    }

    .interactive-graph .node-main:nth-child(5n) {
      animation: twinkle 12s ease-in-out infinite;
      animation-delay: 4s;
    }
  }

  /* Désactivation pour préférence mouvement réduit */
  @media (prefers-reduced-motion: reduce) {
    .interactive-graph * {
      animation: none !important;
      transition: none !important;
    }
  }

  .btn {
    @apply inline-flex items-center justify-center rounded-md px-4 py-2 text-sm font-medium transition-all duration-200;
    @apply focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 focus-visible:ring-offset-background;
  }

  .btn-primary {
    @apply btn shadow-sm;
    background: linear-gradient(135deg, var(--sol-cyan), var(--sol-blue));
    color: var(--sol-base3);
  }

  .btn-primary:hover {
    transform: scale(1.02);
    box-shadow: 0 4px 12px rgba(42, 161, 152, 0.3);
  }

  .btn-primary:active {
    transform: scale(0.98);
  }

  .btn-secondary {
    @apply btn bg-background border border-subtle text-foreground shadow-sm hover:bg-muted;
  }

  .btn-danger {
    @apply btn bg-destructive text-white shadow-sm;
  }

  .btn-danger:hover {
    opacity: 0.9;
  }

  .card {
    @apply border border-transparent rounded-lg shadow-sm transition-all duration-300 hover:shadow-md backdrop-blur-sm p-6;
    background-color: var(--background);
  }

  .card:hover {
    border-color: var(--subtle);
  }

  .input-field {
    @apply w-full px-3 py-2 border border-subtle focus:outline-none focus:border-foreground transition-colors duration-200;
  }

  .search-input {
    @apply glass text-foreground rounded-full outline-none transition-all duration-300;
  }

  .search-input:focus {
    box-shadow: 0 0 0 2px rgba(42, 161, 152, 0.5);
    border-color: rgba(42, 161, 152, 0.4);
  }

  /* Styles pour les backlinks [[mot]] */
  .backlink {
    @apply text-foreground hover:opacity-70 font-normal underline transition-opacity duration-200;
    text-decoration: underline;
  }

  .backlink[data-missing='true'] {
    @apply text-subtle hover:opacity-70;
  }

  /* Prose styles pour les billets */
  .prose {
    @apply text-foreground leading-relaxed;
  }

  .prose h1,
  .prose h2,
  .prose h3 {
    @apply font-serif text-foreground mb-4 font-light;
  }

  .prose h1 {
    @apply text-3xl;
  }

  .prose h2 {
    @apply text-2xl;
  }

  .prose h3 {
    @apply text-xl;
  }

  .prose p {
    @apply mb-4 text-base;
  }

  .prose blockquote {
    @apply border-l-2 border-subtle pl-4 italic text-subtle my-6;
  }

  .prose ul,
  .prose ol {
    @apply mb-4 pl-6;
  }

  .prose li {
    @apply mb-2;
  }
}

/* motif de grille très léger pour le hero */
.grid-pattern {
  background-image:
    radial-gradient(currentColor 1px, transparent 1px),
    radial-gradient(currentColor 1px, transparent 1px);
  background-size:
    24px 24px,
    24px 24px;
  background-position:
    0 0,
    12px 12px;
  color: rgba(0, 0, 0, 0.05);
}

:root .dark .grid-pattern {
  color: rgba(255, 255, 255, 0.06);
}

/* QuoteTicker animation */
.ticker {
  animation: ticker-scroll 40s linear infinite;
}

@keyframes ticker-scroll {
  0% {
    transform: translateX(0%);
  }

  100% {
    transform: translateX(-50%);
  }
}

@media (prefers-reduced-motion: reduce) {
  .ticker {
    animation: none;
  }
}

/* --- L'athanor accents (S1 minimal) --- */
.accent-card {
  position: relative;
}

.accent-card::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 2px;
  background: linear-gradient(180deg, rgba(0, 0, 0, 0.08), rgba(0, 0, 0, 0));
}

.dark .accent-card::before {
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.18), rgba(255, 255, 255, 0));
}

/* Lecture un peu plus souple */
p,
li {
  text-wrap: pretty;
}

/* Légère amélioration des hover sur liens */
a:hover {
  text-underline-offset: 4px;
  text-decoration-thickness: from-font;
}

/* Utilitaire pour zone de lecture étroite (à activer au besoin) */
.reading {
  max-width: 72ch;
}

/* Animation pour l'effet Ripple */
@keyframes ripple-effect {
  0% {
    transform: scale(0);
    opacity: 1;
  }

  100% {
    transform: scale(4);
    opacity: 0;
  }
}

/* Enhanced search result snippet styling */
.card-search-result strong {
  @apply font-semibold text-foreground px-1 py-0.5 rounded;
  background-color: rgba(42, 161, 152, 0.1);
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
  text-shadow: 0 1px 1px rgba(0, 0, 0, 0.05);
}